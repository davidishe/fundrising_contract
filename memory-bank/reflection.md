# –†–ï–§–õ–ï–ö–°–ò–Ø: TON Crowdfunding System

## üìä –û–ë–ó–û–† –ü–†–û–ï–ö–¢–ê

**–ü—Ä–æ–µ–∫—Ç**: –ü—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—Ä–∞—É–¥—Ñ–∞–Ω–¥–∏–Ω–≥–∞ –Ω–∞ TON  
**–ü–µ—Ä–∏–æ–¥**: VAN ‚Üí PLAN ‚Üí BUILD ‚Üí TESTS  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: Level 3 (Intermediate System)  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê  

## ‚úÖ –î–û–°–¢–ò–ñ–ï–ù–ò–Ø –ò –£–°–ü–ï–•–ò

### 1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –†–µ—à–µ–Ω–∏–µ**
- ‚úÖ **–£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –ü–µ—Ä–µ—à–ª–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ–π 4-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ–π –∫ –ø—Ä–æ—Å—Ç–æ–π 3-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
- ‚úÖ **Master-Child –ø–∞—Ç—Ç–µ—Ä–Ω**: –£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω CrowdfundingMaster + UserInvestment
- ‚úÖ **Jetton –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≥–æ—Ç–æ–≤—ã–π TEP-74 jetton —Å—Ç–∞–Ω–¥–∞—Ä—Ç –≤–º–µ—Å—Ç–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ user –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç bottleneck

### 2. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã**

#### CrowdfundingMaster (144 —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ **–ü—Ä–∏–µ–º –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `Invest` —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **–†–∞—Å—á–µ—Ç –¥–∂–µ—Ç—Ç–æ–Ω–æ–≤**: `jettonsToMint = investmentAmount * ton("1") / currentPrice`
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ User –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π deploy —á–µ—Ä–µ–∑ `initOf UserInvestment`
- ‚úÖ **–ê–¥–º–∏–Ω —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ó–∞—â–∏—â–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ `SetPrice`
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º—ã (`MinInvestment: 0.1 TON`)

#### UserInvestment (173 —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ **FIFO –∞–ª–≥–æ—Ä–∏—Ç–º**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "–ø–µ—Ä–≤—ã–π –≤–æ—à–µ–ª - –ø–µ—Ä–≤—ã–π –≤—ã—à–µ–ª"
- ‚úÖ **–ò—Å—Ç–æ—Ä–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π**: –•—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å —Ü–µ–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ –∏ timestamp
- ‚úÖ **–†–∞—Å—á–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞**: `tonToRefund = jettonsToRefund * record.price / ton("1")`
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö**: –¢–æ–ª—å–∫–æ master –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏

#### Jetton Contracts (–ü–æ–ª–Ω–∞—è TEP-74 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- ‚úÖ **JettonMinter**: 148 —Å—Ç—Ä–æ–∫, –ø–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å mint/burn
- ‚úÖ **JettonWallet**: 163 —Å—Ç—Ä–æ–∫–∏, transfer/receive —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ **Message —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

### 3. **–¢–µ—Å—Ç–æ–≤–æ–µ –ü–æ–∫—Ä—ã—Ç–∏–µ**

#### Comprehensive Test Suite (1,800+ —Å—Ç—Ä–æ–∫ —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ **Unit —Ç–µ—Å—Ç—ã**: `crowdfunding-master.spec.ts` (141 —Å—Ç—Ä–æ–∫–∞)
- ‚úÖ **Integration —Ç–µ—Å—Ç—ã**: `integration.spec.ts` (223 —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ **User –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Ç–µ—Å—Ç—ã**: `user-investment.spec.ts` (149 —Å—Ç—Ä–æ–∫)
- ‚úÖ **Edge cases**: `edge-cases.spec.ts` (255 —Å—Ç—Ä–æ–∫)
- ‚úÖ **Jetton —Ç–µ—Å—Ç—ã**: `jetton.spec.ts` (1279 —Å—Ç—Ä–æ–∫)

#### –ü–æ–∫—Ä—ã—Ç—ã–µ –°—Ü–µ–Ω–∞—Ä–∏–∏
- ‚úÖ **Investment flows**: –û–¥–∏–Ω–æ—á–Ω—ã–µ –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
- ‚úÖ **Price management**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—ã –∞–¥–º–∏–Ω–æ–º
- ‚úÖ **Access control**: –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ **Edge cases**: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ/–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Å—É–º–º—ã
- ‚úÖ **Multi-user scenarios**: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **FIFO refunds**: –í–æ–∑–≤—Ä–∞—Ç –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º —Ü–µ–Ω–∞–º

## üí° –ö–õ–Æ–ß–ï–í–´–ï –ò–ù–°–ê–ô–¢–´

### 1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è**
- **Gas –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `SendIgnoreErrors` –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –≥–∞–∑–∞
- **State management**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ map —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- **Error handling**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å require –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
- **Contract interaction**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π deploy –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

### 2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –†–µ—à–µ–Ω–∏—è**
- **Separation of concerns**: –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏
- **Jetton integration**: –£–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞
- **FIFO algorithm**: –≠–ª–µ–≥–∞–Ω—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞
- **Admin controls**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Ownable trait

### 3. **–ö–∞—á–µ—Å—Ç–≤–æ –ö–æ–¥–∞**
- **Type safety**: –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Tact
- **Documentation**: –ü–æ–Ω—è—Ç–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Constants**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç (MinInvestment, GasForDeploy)
- **Testing**: Comprehensive coverage –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

## üöß –í–´–Ø–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –í–´–ó–û–í–´

### 1. **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–∞—è Jetton –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
```tact
// TODO: Burn jettons (will implement when jetton integration is ready)
```
- **–ü—Ä–æ–±–ª–µ–º–∞**: UserInvestment –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —Å–∂–∏–≥–∞–Ω–∏–µ –¥–∂–µ—Ç—Ç–æ–Ω–æ–≤ –ø—Ä–∏ refund
- **–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞**: –§—É–Ω–∫—Ü–∏—è `InitiateRefund` —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç state, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `JettonBurn`
- **–í–ª–∏—è–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ - –¥–∂–µ—Ç—Ç–æ–Ω—ã –Ω–µ —Å–∂–∏–≥–∞—é—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ

### 2. **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø: CrowdfundingMaster –Ω–µ –º–∏–Ω—Ç–∏—Ç –¥–∂–µ—Ç—Ç–æ–Ω—ã**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è—Ö –¥–∂–µ—Ç—Ç–æ–Ω—ã –Ω–µ –≤—ã–¥–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- **–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞**: –í `receive(msg: Invest)` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤—ã–∑–æ–≤ `Mint` –∫ jettonMaster
- **–í–ª–∏—è–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ä—É—é—Ç TON, –Ω–æ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –¥–∂–µ—Ç—Ç–æ–Ω—ã

### 3. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: Jetton address –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω**
- **–ü—Ä–æ–±–ª–µ–º–∞**: jettonMaster –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ init, –Ω–æ —Ä–µ–∞–ª—å–Ω–æ–π —Å–≤—è–∑–∏ –Ω–µ—Ç
- **–ê–Ω–∞–ª–∏–∑**: –ö–æ–Ω—Ç—Ä–∞–∫—Ç –æ–∂–∏–¥–∞–µ—Ç –∞–¥—Ä–µ—Å jetton minter, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
- **–í–ª–∏—è–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º jetton –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º

### 4. **–ù–µ–ø–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ç–æ–ª—å–∫–æ internal state changes, –Ω–µ jetton flows
- **–ê–Ω–∞–ª–∏–∑**: `user-investment.spec.ts` —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ `RecordInvestment`, –Ω–µ refund
- **–í–ª–∏—è–Ω–∏–µ**: –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ invest‚Üímint‚Üírefund‚Üíburn

### 5. **FIFO –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è**
- **–ü—Ä–æ–±–ª–µ–º–∞**: –í `user-investment.spec.ts` –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ refund
- **–ê–Ω–∞–ª–∏–∑**: –¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç FIFO –≤–æ–∑–≤—Ä–∞—Ç
- **–í–ª–∏—è–Ω–∏–µ**: –ö–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞

## üìö –ò–ó–í–õ–ï–ß–ï–ù–ù–´–ï –£–†–û–ö–ò

### 1. **–£–ø—Ä–æ—â–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**
- **–£—Ä–æ–∫**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –ø—Ä–∞–≤, —Ç—Ä–µ–±—É—è —É–ø—Ä–æ—â–µ–Ω–∏—è
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ü—Ä–æ—Å—Ç–æ—Ç–∞ > —Å–ª–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è MVP
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ë–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–∞—è –∏ maintainable —Å–∏—Å—Ç–µ–º–∞

### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤**
- **–£—Ä–æ–∫**: –ì–æ—Ç–æ–≤—ã–µ TEP-74 jetton –ª—É—á—à–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: Leverage ecosystem standards
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ú–µ–Ω—å—à–µ –∫–æ–¥–∞, –±–æ–ª—å—à–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### 3. **Test-Driven Development**
- **–£—Ä–æ–∫**: Comprehensive —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –ü–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –∫–æ–¥–æ–º
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –∫–æ–¥–µ

### 4. **Iterative Design**
- **–£—Ä–æ–∫**: –û—Ç —Å–ª–æ–∂–Ω–æ–≥–æ –∫ –ø—Ä–æ—Å—Ç–æ–º—É —á–µ—Ä–µ–∑ —Ñ–∏–¥–±–µ–∫
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –°–ª—É—à–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü—Ä–æ–¥—É–∫—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–º –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è–º

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 1. **–î–ª—è Complete Implementation**
```tact
// –í CrowdfundingMaster –¥–æ–±–∞–≤–∏—Ç—å:
send(SendParameters{
    to: self.jettonMaster,
    value: ton("0.05"),
    body: Mint{
        mintMessage: InternalMintMessage{
            amount: jettonsToMint,
            receiver: ctx.sender,
            forwardTonAmount: ton("0.01"),
            forwardPayload: emptyCell()
        }
    }.toCell()
});
```

### 2. **–î–ª—è UserInvestment Refund**
```tact
// –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ burning:
send(SendParameters{
    to: userJettonWallet,
    value: ton("0.05"),
    body: JettonBurn{
        amount: msg.jettonAmount,
        responseDestination: self.owner
    }.toCell()
});
```

### 3. **Gas Optimization**
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –æ–¥–Ω—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ storage patterns
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å message —Ä–∞–∑–º–µ—Ä—ã

## üìà –ü–†–û–¶–ï–°–°–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 1. **Documentation**
- ‚úÖ **–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞**: –•–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è Memory Bank
- üîß **–£–ª—É—á—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å inline –∫–æ–¥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏

### 2. **Testing Strategy**
- ‚úÖ **–°–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞**: Comprehensive test coverage
- üîß **–£–ª—É—á—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å integration —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ jetton

### 3. **Code Review Process**
- üîß **–£–ª—É—á—à–µ–Ω–∏–µ**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π peer review –ø—Ä–æ—Ü–µ—Å—Å
- üîß **–£–ª—É—á—à–µ–Ω–∏–µ**: Automated security checks

## üéØ –û–ë–©–ê–Ø –û–¶–ï–ù–ö–ê

### –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ü—Ä–æ–µ–∫—Ç–∞: 60% ‚ö†Ô∏è

**–ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å –æ—Ç–ª–∏—á–Ω–æ (70%)**:
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–æ—â–µ–Ω–∏–µ
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Tact/TON patterns
- ‚úÖ FIFO –∞–ª–≥–æ—Ä–∏—Ç–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –∫–æ–¥–µ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–∫–∏ (40%)**:
- ‚ùå **Jetton –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç** - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
- ‚ùå **FIFO refund –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è** - –∫–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞
- ‚ùå **End-to-end flow –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - invest‚Üímint‚Üírefund‚Üíburn —Ä–∞–∑–æ—Ä–≤–∞–Ω
- ‚ùå **Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å 30%** - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–µ—Ç–∞–ª—å–Ω–∞—è –û—Ü–µ–Ω–∫–∞ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

**CrowdfundingMaster**: 40% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–∏–µ–º –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –∏ —Ä–∞—Å—á–µ—Ç –¥–∂–µ—Ç—Ç–æ–Ω–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ UserInvestment –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤  
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –º–∏–Ω—Ç–∏–Ω–≥ –¥–∂–µ—Ç—Ç–æ–Ω–æ–≤
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ jettonMaster –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏

**UserInvestment**: 50% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ FIFO –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
- ‚ùå Refund –Ω–µ —Å–∂–∏–≥–∞–µ—Ç –¥–∂–µ—Ç—Ç–æ–Ω—ã
- ‚ùå –§—É–Ω–∫—Ü–∏—è –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞

**Jetton Contracts**: 100% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –ü–æ–ª–Ω–∞—è TEP-74 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ Comprehensive —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Production ready

**Test Coverage**: 30% —Ä–µ–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è individual —Ñ—É–Ω–∫—Ü–∏–π
- ‚ùå Integration —Ç–µ—Å—Ç—ã –Ω–µ –ø–æ–∫—Ä—ã–≤–∞—é—Ç jetton flows
- ‚ùå FIFO refund –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
- ‚ùå End-to-end —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç

## üöÄ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –°–õ–ï–î–£–Æ–©–ò–• –®–ê–ì–û–í

### 1. **Immediate (Level 1)**
- –ó–∞–≤–µ—Ä—à–∏—Ç—å jetton –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ CrowdfundingMaster
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å jetton burning –≤ UserInvestment
- –î–æ–±–∞–≤–∏—Ç—å end-to-end —Ç–µ—Å—Ç—ã

### 2. **Short-term (Level 2)**
- Security audit –∫–æ–¥–∞
- Gas optimization –∞–Ω–∞–ª–∏–∑
- Deploy –Ω–∞ testnet

### 3. **Long-term (Level 3)**
- Mainnet deployment
- UI/Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Advanced features (–ø–∞—É–∑—ã, emergency stops)

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ü–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –∫–æ–¥–∞, –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **–æ—Ç–ª–∏—á–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –æ—Å–Ω–æ–≤—É** —Å **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–µ–ª–∞–º–∏ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**. 

### ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è**:
- –≠–ª–µ–≥–∞–Ω—Ç–Ω–æ–µ —É–ø—Ä–æ—â–µ–Ω–∏–µ –æ—Ç 4-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ–π –∫ 3-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Master-Child –ø–∞—Ç—Ç–µ—Ä–Ω–∞
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è FIFO –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≤ –∫–æ–¥–µ
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Tact/TON —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤

### ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ü—Ä–æ–±–ª–µ–º—ã**:
- **–°–∏—Å—Ç–µ–º–∞ –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞**: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç jetton mint/burn –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ**: –∫–ª—é—á–µ–≤—ã–µ flows –Ω–µ –ø–æ–∫—Ä—ã—Ç—ã
- **Production –Ω–µ–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç end-to-end

### üéØ **–ì–ª–∞–≤–Ω—ã–π –£—Ä–æ–∫**: 
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚â† Implementation**. –ö—Ä–∞—Å–∏–≤—ã–π –∫–æ–¥ –±–µ–∑ –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### üìä **–†–µ–∞–ª—å–Ω–æ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ**: MVP –Ω–∞ 60% - –Ω—É–∂–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ jetton –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã.

# Reflection ‚Äì Debugging Refund Logic (2025-06-17)

## What was implemented / fixed
1. Identified and fixed `exit code 9` (Cell underflow) that occurred when `JettonWallet` validated `forward_payload`.
2. Changed refund script (`refund.ts`):
   ‚Ä¢ Correct Either-encoding (`bit 1 + ref`).
   ‚Ä¢ Accept fractional jetton amounts.
   ‚Ä¢ Fixed table formatting (6 decimals) to avoid visual rounding errors.
3. Added balance-safety check in `CrowdfundingMaster` to prevent partial refunds.
4. Added utility `setPrice.ts` fix to point to existing `CrowdfundingMaster`.
5. Wrote sandbox test skeleton (`tests/refund-flow.spec.ts`).

## What went well
‚Ä¢ Reproduced on-chain failure quickly using explorer logs.
‚Ä¢ Leveraged Blueprint sandbox to reproduce and verify fixes locally.
‚Ä¢ Clear separation of concerns: contract bugs vs script UX bugs.
‚Ä¢ Incremental commits ‚Äì each change isolated and testable.

## Challenges
‚Ä¢ Initial confusion due to UI rounding (0.001 ‚Üí 0.0001) masked real on-chain price.
‚Ä¢ `parseInt` silently truncating fractional jetton amount caused under-refund.
‚Ä¢ Contract had no pre-refund balance check ‚Äì led to partial payout.

## Lessons learned
1. Always log raw nano-values when debugging TON contracts to avoid UX-level rounding traps.
2. Validate user input thoroughly (floats, commas, parseInt pitfalls).
3. Contracts should check available balance **before** mutating state.
4. Add end-to-end tests early ‚Äì sandbox tests would have caught truncation bug.

## Improvements planned
* Extend test suite (unit + integration) to cover all refund scenarios.
* Implement CLI validation helpers for price / amount inputs.
* Automate deployment of updated contract code with `setcode` flow.
* Document known gotchas in developer README.

---
*Reflection complete ‚Äì ready for ARCHIVE phase.* 